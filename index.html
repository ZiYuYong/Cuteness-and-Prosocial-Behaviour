<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindchenschema and Kindness Study</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }

        h2 {
            color: #444;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        h3 {
            color: #555;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .section {
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .informed-consent {
            max-height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .zoo-entrance {
            text-align: center;
            margin: 30px 0;
        }

        .zoo-entrance img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .animal-display {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        .animal-display img {
            max-width: 400px;
            width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            margin-bottom: 20px;
        }

        .slider-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .slider-value {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-weight: 600;
        }

        .amount-display {
            padding: 10px;
            background: #e8f5e9;
            border-radius: 5px;
            color: #2e7d32;
        }

        .refund-display {
            padding: 10px;
            background: #fff3e0;
            border-radius: 5px;
            color: #e65100;
        }

        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .likert-option {
            text-align: center;
            flex: 1;
            min-width: 80px;
            margin: 5px;
        }

        .likert-option input[type="radio"] {
            display: none;
        }

        .likert-option label {
            display: block;
            padding: 12px 8px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .likert-option input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .likert-option label:hover {
            background: #e0e0e0;
        }

        .likert-option input[type="radio"]:checked + label:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .attention-check-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .attention-check-item {
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .attention-check-item:hover {
            transform: scale(1.05);
        }

        .attention-check-item input[type="checkbox"] {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .attention-check-item img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            border: 3px solid transparent;
            transition: border-color 0.3s;
        }

        .attention-check-item input[type="checkbox"]:checked ~ img {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        .checkbox-group {
            margin: 20px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .checkbox-group label:hover {
            background: #f0f0f0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            margin-top: 2px;
            cursor: pointer;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .error-message {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }

        .thank-you {
            text-align: center;
            padding: 40px;
        }

        .thank-you h2 {
            color: #4caf50;
            margin-bottom: 20px;
        }

        .summary {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="progress-bar">
        <div class="progress-fill" id="progressBar"></div>
    </div>

    <div class="container">
        <!-- Section 1: Informed Consent -->
        <div id="section1" class="section active">
            <h1>Kindchenschema and Kindness: The Role of Cuteness in Prosocial Behaviour</h1>
            
            <div class="informed-consent">
                <p><strong>Dear Participant,</strong></p>
                <p>Welcome to participate in the study titled "Kindchenschema and Kindness: The Role of Cuteness in Prosocial Behaviour". Should you have any questions regarding this study, feel free to direct them to the researcher. The details are available in this consent form.</p>
                
                <h3>Description of the project:</h3>
                <p>This study aims to investigate the effect of cuteness on prosocial behaviour. To take part in this study, you must age between 18 and 25 years old. In addition, you should not have any visionary problems.</p>
                
                <h3>What will be done:</h3>
                <p>If you agree to participate in this study, you will need to fill in an informed consent form to indicate your voluntary participation. Moving on, you will need to fill in a demographic form to indicate that you are eligible to participate in the current study. Next, you will need to complete the Dictator Game, a task designed to measure your prosocial behaviour. The entire study will take no longer than 30 minutes to complete.</p>
                
                <h3>Risks or discomfort:</h3>
                <p>There is no foreseeable risk or discomfort from this study. If you find your participation in this study has caused you to experience any psychological harm, you may contact the Centre for Psychological and Counselling Services (CPCS) at cpcs.hu@help.edu.my or dial 03-78493200 to make an appointment or visit any reputable counselling centres near you. Please note that CPCS sees clients only on an appointment basis.</p>
                
                <p style="margin-top: 15px;">
                Centre for Psychological & Counselling Services (CPCS)<br>
                Level 6, Block B,<br>
                HELP University Subang 2,<br>
                Persiaran Cakerawala, Seksyen U4,<br>
                40150 Shah Alam, Selangor.<br>
                Tel: 03-7849 3200<br>
                Email: cpcs.hu@help.edu.my
                </p>
                
                <h3>Benefits of this study:</h3>
                <p>There will be some compensation for participating in this study. In addition, your participation will help advance the current understanding of the effect of cuteness on prosocial behaviour.</p>
                
                <h3>Confidentiality:</h3>
                <p>We will take every effort to ensure that any information collected from you remains confidential. Only the researcher and the researcher's supervisor will be able to access the information gathered.</p>
                
                <h3>Decision to quit at any time:</h3>
                <p>Participation in this study is voluntary based. You reserve the right to withdraw at any time, with no adverse actions being implemented. If you wish to terminate participation, please exit the Google Form without submitting your responses.</p>
                
                <h3>Rights and complaints:</h3>
                <p>This study has been reviewed and approved by the Ethics Review Board, Department of Psychology, Faculty of Behavioural Sciences at HELP University [ERB Approval Code: ].</p>
                
                <p>For any research-related problems, complaints, or questions regarding participants' rights, please contact the Chairperson of the Ethics Review Board.</p>
                
                <p style="margin-top: 15px;">
                Chairperson, Ethics Review Board<br>
                Department of Psychology<br>
                Faculty of Behavioural Sciences<br>
                Level 3, Block B HELP University -- Subang 2<br>
                Persiaran Cakerawala, Seksyen U4<br>
                40150 Shah Alam<br>
                Selangor Darul Ehsan Malaysia<br>
                Email: psych.erb@help.edu.my<br>
                Phone: +603 7849 3000
                </p>
                
                <p style="margin-top: 20px;">For any enquiries about this particular study, please feel free to contact the researcher via the email address as stated below:</p>
                
                <p>
                Researcher: Yong Zi Yu B2100815@helplive.edu.my<br>
                Research Supervisor: Ms. Khor Khai Ling khailing.k@help.edu.my
                </p>
                
                <p style="margin-top: 20px;"><strong>Thank You!</strong></p>
                
                <p style="margin-top: 15px;"><strong>By clicking the button below, you acknowledge:</strong></p>
                <p>Your participation in the study is voluntary.</p>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="consent()">I consent, begin the study</button>
                <button class="btn btn-secondary" onclick="showThankYou()">I do not consent</button>
            </div>
        </div>

        <!-- Section 2: Demographics -->
        <div id="section2" class="section">
            <h2>Demographic Information</h2>
            
            <div class="form-group">
                <label for="age">Age:</label>
                <select id="age" required>
                    <option value="">Select your age</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="others">Others</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="gender">Gender:</label>
                <select id="gender" required>
                    <option value="">Select your gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="non-binary">Non-binary/Third gender</option>
                    <option value="prefer-not">Prefer not to say</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="nationality">Nationality:</label>
                <select id="nationality" required>
                    <option value="">Select your nationality</option>
                    <option value="malaysian">Malaysian</option>
                    <option value="non-malaysian">Non-Malaysian</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="vision">Do you have any vision-related conditions that may affect your ability to view images clearly (e.g., myopia, astigmatism, short-sightedness, long-sightedness, blurry vision, colour blindness, etc)?</label>
                <p style="font-size: 14px; color: #666; margin: 10px 0;">
                    *Corrected vision = You have a vision issue, but you wear glasses or contact lenses that help you see clearly.<br>
                    *Uncorrected vision = You have a vision issue, but you don't wear glasses or contact lenses, so your vision is still blurry or unclear.
                </p>
                <select id="vision" required>
                    <option value="">Select your answer</option>
                    <option value="no-condition">No, I don't have any vision-related condition</option>
                    <option value="corrected">Yes, but corrected with glasses or contact lenses</option>
                    <option value="uncorrected">Yes, uncorrected</option>
                    <option value="prefer-not">Prefer not to say</option>
                </select>
            </div>
            
            <div class="error-message" id="demographicsError">
                Please answer all questions before proceeding.
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="validateDemographics()">Continue</button>
            </div>
        </div>

        <!-- Section 3: Zoo Entrance -->
        <div id="section3" class="section">
            <h2>Virtual Zoo Visit</h2>
            <p style="text-align: center; margin: 20px 0;">In this study, you will join a virtual zoo visit.</p>
            
            <div class="zoo-entrance">
                <img src="https://imgur.com/wTReFzy.png" alt="Zoo Entrance">
            </div>
            
            <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <p><strong>Instructions:</strong></p>
                <p>Every time you visit an animal, there is a RM10 visiting fee.</p>
                <p>You can use this RM10 to buy food for the animal (in the range of RM0.00 to RM10.00), OR</p>
                <p>Skip buying food, and the RM10 will be refunded to you at the end of the study.</p>
                <p>You will see several animals and make this choice for each one.</p>
                <p>After finishing all the animals, we will show the total amount you "spent" on the animals.</p>
                <p style="margin-top: 15px; font-style: italic;">There are no right or wrong answers. Just decide how much you want to keep for yourself and give based on how you feel about the animal shown in that round.</p>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="startDictatorGame()">Enter Zoo</button>
            </div>
        </div>

        <!-- Section 4: Dictator Game -->
        <div id="section4" class="section">
            <h2 id="animalTitle">Animal 1 of 14</h2>
            
            <div class="animal-display">
                <img id="animalImage" src="" alt="Animal">
                <h3>Meet this wonderful animal!</h3>
                <p>In the range of RM0.00 to RM10.00, decide how much you are willing to donate to the animal for its food, shelter, or medical care.</p>
                
                <div class="slider-container">
                    <label for="donationSlider">Donation Amount:</label>
                    <input type="range" id="donationSlider" min="0" max="10" step="0.01" value="0">
                    
                    <div class="slider-value">
                        <div class="amount-display">
                            Amount for the animal: RM<span id="donationAmount">0.00</span>
                        </div>
                        <div class="refund-display">
                            Amount left to be refunded: RM<span id="refundAmount">10.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="nextAnimal()">Continue</button>
            </div>
        </div>

        <!-- Section 5: Manipulation Check -->
        <div id="section5" class="section">
            <h2>Rate the Animals</h2>
            <p>Please rate how cute you found each animal on a scale from 1 to 7:</p>
            
            <div id="manipulationCheckContainer"></div>
            
            <div class="error-message" id="manipulationError">
                Please rate all animals before proceeding.
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="validateManipulationCheck()">Continue</button>
            </div>
        </div>

        <!-- Section 6: Attention Check -->
        <div id="section6" class="section">
            <h2>Attention Check</h2>
            <p>Please select all the animals that you saw during the zoo visit:</p>
            
            <div class="attention-check-images">
                <div class="attention-check-item">
                    <input type="checkbox" id="check1" value="correct1">
                    <img src="https://i.imgur.com/kE9U8g1.png" alt="Animal 1">
                </div>
                <div class="attention-check-item">
                    <input type="checkbox" id="check2" value="correct2">
                    <img src="https://i.imgur.com/dig6OlQ.png" alt="Animal 2">
                </div>
                <div class="attention-check-item">
                    <input type="checkbox" id="check3" value="correct3">
                    <img src="https://i.imgur.com/xaxASmm.png" alt="Animal 3">
                </div>
                <div class="attention-check-item">
                    <input type="checkbox" id="check4" value="incorrect">
                    <img src="https://i.imgur.com/JBSsw5g.png" alt="Animal 4">
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="recordAttentionCheck()">Continue</button>
            </div>
        </div>

        <!-- Section 7: Validity Test -->
        <div id="section7" class="section">
            <h2>Understanding Check</h2>
            <p>What are the requirements for the task? (Select all that applies)</p>
            
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="validity1" value="correct1">
                    <span>The amount that I indicate on the slider is the amount will be given to the animal recipient</span>
                </label>
                <label>
                    <input type="checkbox" id="validity2" value="incorrect1">
                    <span>The amount that I indicate on the slider is the amount that I wish to keep for myself</span>
                </label>
                <label>
                    <input type="checkbox" id="validity3" value="incorrect2">
                    <span>I only have RM10 to donate throughout the study</span>
                </label>
                <label>
                    <input type="checkbox" id="validity4" value="correct2">
                    <span>I have RM10 to donate to each of the animal</span>
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="recordValidityTest()">Continue</button>
            </div>
        </div>

        <!-- Section 8: Debriefing -->
        <div id="section8" class="section">
            <h2>Debriefing Statement</h2>
            
            <div style="background: #fff9c4; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <p><strong>Thank you for taking part in this study!</strong></p>
                
                <p style="margin-top: 15px;">This research aimed to explore how seeing cute versus non-cute animals might influence prosocial behaviour. In this case, how much money you chose to share in each round of the game.</p>
                
                <p style="margin-top: 15px;">To make sure your responses were genuine, we told you that your decisions could affect a real payout. However, this was not actually the case as no real money was involved and you no need to pay anything. This small deception was deemed necessary to prevent participants from making artificially generous choices, which could have compromised the validity of the findings. However, your participation will help advance the current understanding of the effect of cuteness on prosocial behaviour.</p>
                
                <p style="margin-top: 15px;">We understand that this may cause some discomfort, and we assure you that all data will be kept confidential and used strictly for academic purposes. If you feel uncomfortable and wish to withdraw your data, you may do so by not submit this form.</p>
                
                <p style="margin-top: 15px;">You have the right to withdraw your participation and request that your data be removed from the study without any penalty.</p>
                
                <p style="margin-top: 15px;">The use of deception was reviewed and approved by the Ethics Review Board of HELP University. Should you have any questions or concerns, or wish to withdraw your participation, please email:</p>
                
                <p style="margin-top: 15px;">
                Researcher: Yong Zi Yu -- B2100815@helplive.edu.my<br>
                Supervisor: Ms. Khor Khai Ling -- khailing.k@help.edu.my<br>
                Ethics Review Board: psych.erb@help.edu.my
                </p>
                
                <p style="margin-top: 20px;"><strong>Thank you again for your participation!</strong></p>
            </div>
            
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="finalConsent">
                    <span>I understand that no real money will be given or received in this study, and I willingly choose to participate in this study</span>
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="submitStudy()">Submit Study</button>
                <button class="btn btn-secondary" onclick="withdrawStudy()">Withdraw from Study</button>
            </div>
        </div>

        <!-- Thank You Page -->
        <div id="thankYouSection" class="section">
            <div class="thank-you">
                <h2>Thank You!</h2>
                <p id="thankYouMessage">Thank you for your interest in this study.</p>
            </div>
        </div>

        <!-- Results Summary (shown after submission) -->
        <div id="resultsSection" class="section">
            <div class="thank-you">
                <h2>Study Completed!</h2>
                <p>Thank you for completing the study. Your responses have been recorded.</p>
                
                <p style="margin-top: 30px;">If you have any questions about this study, please contact:</p>
                <p>Researcher: Yong Zi Yu -- B2100815@helplive.edu.my</p>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script URL for data submission
        const GOOGLE_SCRIPT_URL = 'YOUR_GOOGLE_SCRIPT_URL_HERE';

        // Study data storage
        const studyData = {
            consent: false,
            demographics: {},
            donations: [],
            manipulationCheck: [],
            attentionCheck: [],
            validityTest: [],
            finalConsent: false
        };

        // Animal images in randomized order
        const animalImages = [
            'https://i.imgur.com/unjRTSV.png',
            'https://i.imgur.com/xaxASmm.png',
            'https://i.imgur.com/q13LDoX.png',
            'https://i.imgur.com/i2d5sZ5.png',
            'https://i.imgur.com/kE9U8g1.png',
            'https://i.imgur.com/kmrTXme.png',
            'https://i.imgur.com/WOhBZZV.png',
            'https://i.imgur.com/O3hxUdz.png',
            'https://i.imgur.com/dig6OlQ.png',
            'https://i.imgur.com/zIz8RP9.png',
            'https://i.imgur.com/2znBUTL.png',
            'https://i.imgur.com/QUc65Uq.png',
            'https://i.imgur.com/02BYRRJ.png',
            'https://i.imgur.com/MqRuE18.png'
        ];

        // Define which animals are babies (odd indices: 0, 2, 4, 6, 8, 10, 12)
        const babyAnimalIndices = [0, 2, 4, 6, 8, 10, 12];
        const adultAnimalIndices = [1, 3, 5, 7, 9, 11, 13];

        let currentAnimalIndex = 0;
        let participantId = '';
        let startTime = new Date();

        // Generate participant ID
        function generateParticipantId() {
            return 'P' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Initialize participant ID on load
        window.addEventListener('DOMContentLoaded', function() {
            participantId = generateParticipantId();
            updateProgressBar(0);
            
            // Setup final consent checkbox listener
            const finalConsentCheckbox = document.getElementById('finalConsent');
            if (finalConsentCheckbox) {
                finalConsentCheckbox.addEventListener('change', function() {
                    const submitBtn = document.querySelector('#section8 .btn');
                    if (submitBtn && submitBtn.textContent === 'Submit Study') {
                        submitBtn.disabled = !this.checked;
                    }
                });
            }
        });

        // Update progress bar
        function updateProgressBar(percentage) {
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        // Show section function
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update progress bar based on section
            const progressMap = {
                'section1': 10,
                'section2': 20,
                'section3': 30,
                'section4': 40,
                'section5': 70,
                'section6': 80,
                'section7': 85,
                'section8': 90,
                'thankYouSection': 100,
                'resultsSection': 100
            };
            
            if (progressMap[sectionId]) {
                updateProgressBar(progressMap[sectionId]);
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Consent function
        function consent() {
            studyData.consent = true;
            showSection('section2');
        }

        // Show thank you page
        function showThankYou() {
            showSection('thankYouSection');
        }

        // Validate demographics
        function validateDemographics() {
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            const nationality = document.getElementById('nationality').value;
            const vision = document.getElementById('vision').value;
            
            // Check if all fields are filled
            if (!age || !gender || !nationality || !vision) {
                const errorDiv = document.getElementById('demographicsError');
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'Please answer all questions before proceeding.';
                return;
            }
            
            // Store demographics
            studyData.demographics = {
                age: age,
                gender: gender,
                nationality: nationality,
                vision: vision
            };
            
            // Check exclusion criteria
            if (age === 'others' || vision === 'uncorrected' || vision === 'prefer-not') {
                showThankYou();
                return;
            }
            
            // Proceed to zoo entrance
            showSection('section3');
        }

        // Start dictator game
        function startDictatorGame() {
            currentAnimalIndex = 0;
            studyData.donations = [];
            showSection('section4');
            displayAnimal();
        }

        // Display current animal
        function displayAnimal() {
            const animalImage = document.getElementById('animalImage');
            const animalTitle = document.getElementById('animalTitle');
            const slider = document.getElementById('donationSlider');
            
            animalImage.src = animalImages[currentAnimalIndex];
            animalTitle.textContent = `Animal ${currentAnimalIndex + 1} of 14`;
            slider.value = 0;
            updateDonationDisplay();
            
            // Update progress within dictator game
            const gameProgress = 40 + (currentAnimalIndex / 14) * 30;
            updateProgressBar(gameProgress);
        }

        // Update donation display
        function updateDonationDisplay() {
            const slider = document.getElementById('donationSlider');
            const donationAmount = parseFloat(slider.value).toFixed(2);
            const refundAmount = (10 - parseFloat(slider.value)).toFixed(2);
            
            document.getElementById('donationAmount').textContent = donationAmount;
            document.getElementById('refundAmount').textContent = refundAmount;
        }

        // Setup slider listener
        document.addEventListener('DOMContentLoaded', function() {
            const slider = document.getElementById('donationSlider');
            if (slider) {
                slider.addEventListener('input', updateDonationDisplay);
            }
        });

        // Next animal
        function nextAnimal() {
            const slider = document.getElementById('donationSlider');
            const donationAmount = parseFloat(slider.value);
            
            // Store donation
            studyData.donations.push({
                animalIndex: currentAnimalIndex,
                animalImage: animalImages[currentAnimalIndex],
                donated: donationAmount,
                refunded: 10 - donationAmount
            });
            
            currentAnimalIndex++;
            
            if (currentAnimalIndex < 14) {
                displayAnimal();
            } else {
                // All animals completed, show manipulation check
                setupManipulationCheck();
                showSection('section5');
            }
        }

        // Setup manipulation check
        function setupManipulationCheck() {
            const container = document.getElementById('manipulationCheckContainer');
            container.innerHTML = '';
            
            animalImages.forEach((image, index) => {
                const checkDiv = document.createElement('div');
                checkDiv.style.marginBottom = '30px';
                checkDiv.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${image}" style="max-width: 300px; height: auto; border-radius: 10px; margin-bottom: 15px;">
                        <p>Animal ${index + 1}</p>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="1" id="cute${index}_1">
                                <label for="cute${index}_1">1<br>Not cute at all</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="2" id="cute${index}_2">
                                <label for="cute${index}_2">2<br>Slightly cute</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="3" id="cute${index}_3">
                                <label for="cute${index}_3">3<br>Somewhat cute</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="4" id="cute${index}_4">
                                <label for="cute${index}_4">4<br>Moderately cute</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="5" id="cute${index}_5">
                                <label for="cute${index}_5">5<br>Quite cute</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="6" id="cute${index}_6">
                                <label for="cute${index}_6">6<br>Very cute</label>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="cute${index}" value="7" id="cute${index}_7">
                                <label for="cute${index}_7">7<br>Extremely cute</label>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(checkDiv);
            });
        }

        // Validate manipulation check
        function validateManipulationCheck() {
            studyData.manipulationCheck = [];
            let allRated = true;
            
            for (let i = 0; i < 14; i++) {
                const rating = document.querySelector(`input[name="cute${i}"]:checked`);
                if (rating) {
                    studyData.manipulationCheck.push({
                        animalIndex: i,
                        rating: parseInt(rating.value)
                    });
                } else {
                    allRated = false;
                }
            }
            
            if (!allRated) {
                document.getElementById('manipulationError').style.display = 'block';
                return;
            }
            
            showSection('section6');
        }

        // Record attention check
        function recordAttentionCheck() {
            studyData.attentionCheck = [];
            const checkboxes = document.querySelectorAll('#section6 input[type="checkbox"]:checked');
            checkboxes.forEach(cb => {
                studyData.attentionCheck.push(cb.value);
            });
            
            showSection('section7');
        }

        // Record validity test
        function recordValidityTest() {
            studyData.validityTest = [];
            const checkboxes = document.querySelectorAll('#section7 input[type="checkbox"]:checked');
            checkboxes.forEach(cb => {
                studyData.validityTest.push(cb.value);
            });
            
            showSection('section8');
        }

        // Submit study
        function submitStudy() {
            const finalConsentCheckbox = document.getElementById('finalConsent');
            if (!finalConsentCheckbox.checked) {
                alert('Please check the consent box to submit the study.');
                return;
            }
            
            studyData.finalConsent = true;
            
            // Prepare data for Google Sheets
            const submissionData = prepareSubmissionData();
            
            // Log data to console for debugging
            console.log('Study data submitted:', submissionData);
            
            // Submit to Google Sheets (if URL is configured)
            if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL !== 'YOUR_GOOGLE_SCRIPT_URL_HERE') {
                submitToGoogleSheets(submissionData);
            }
            
            showSection('resultsSection');
        }

        // Withdraw from study
        function withdrawStudy() {
            if (confirm('Are you sure you want to withdraw from the study? Your data will not be saved.')) {
                showThankYou();
            }
        }

        // Prepare submission data
        function prepareSubmissionData() {
            const endTime = new Date();
            const duration = Math.round((endTime - startTime) / 1000 / 60); // in minutes
            
            // Calculate baby vs adult donations
            let babyTotal = 0;
            let adultTotal = 0;
            let babyCount = 0;
            let adultCount = 0;
            
            studyData.donations.forEach((donation, index) => {
                if (babyAnimalIndices.includes(index)) {
                    babyTotal += donation.donated;
                    babyCount++;
                } else {
                    adultTotal += donation.donated;
                    adultCount++;
                }
            });
            
            const data = {
                date_time: endTime.toLocaleString(),
                participant_id: participantId,
                age: studyData.demographics.age,
                gender: studyData.demographics.gender,
                nationality: studyData.demographics.nationality,
                vision_condition: studyData.demographics.vision,
                
                // Individual animal donations
                animal_1_donation: studyData.donations[0]?.donated || 0,
                animal_2_donation: studyData.donations[1]?.donated || 0,
                animal_3_donation: studyData.donations[2]?.donated || 0,
                animal_4_donation: studyData.donations[3]?.donated || 0,
                animal_5_donation: studyData.donations[4]?.donated || 0,
                animal_6_donation: studyData.donations[5]?.donated || 0,
                animal_7_donation: studyData.donations[6]?.donated || 0,
                animal_8_donation: studyData.donations[7]?.donated || 0,
                animal_9_donation: studyData.donations[8]?.donated || 0,
                animal_10_donation: studyData.donations[9]?.donated || 0,
                animal_11_donation: studyData.donations[10]?.donated || 0,
                animal_12_donation: studyData.donations[11]?.donated || 0,
                animal_13_donation: studyData.donations[12]?.donated || 0,
                animal_14_donation: studyData.donations[13]?.donated || 0,
                
                // Total and average donations
                total_adult_donation: adultTotal.toFixed(2),
                total_baby_donation: babyTotal.toFixed(2),
                average_adult_donation: (adultTotal / adultCount).toFixed(2),
                average_baby_donation: (babyTotal / babyCount).toFixed(2),
                
                // Individual refunds
                animal_1_refund: studyData.donations[0]?.refunded || 10,
                animal_2_refund: studyData.donations[1]?.refunded || 10,
                animal_3_refund: studyData.donations[2]?.refunded || 10,
                animal_4_refund: studyData.donations[3]?.refunded || 10,
                animal_5_refund: studyData.donations[4]?.refunded || 10,
                animal_6_refund: studyData.donations[5]?.refunded || 10,
                animal_7_refund: studyData.donations[6]?.refunded || 10,
                animal_8_refund: studyData.donations[7]?.refunded || 10,
                animal_9_refund: studyData.donations[8]?.refunded || 10,
                animal_10_refund: studyData.donations[9]?.refunded || 10,
                animal_11_refund: studyData.donations[10]?.refunded || 10,
                animal_12_refund: studyData.donations[11]?.refunded || 10,
                animal_13_refund: studyData.donations[12]?.refunded || 10,
                animal_14_refund: studyData.donations[13]?.refunded || 10,
                
                // Total refund
                total_refund: (140 - babyTotal - adultTotal).toFixed(2),
                
                study_duration_minutes: duration
            };
            
            return data;
        }

        // Submit to Google Sheets
        function submitToGoogleSheets(data) {
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                console.log('Data submitted successfully');
            })
            .catch((error) => {
                console.error('Error submitting data:', error);
            });
        }
