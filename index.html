<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Zoo Study - Kindchenschema and Kindness</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-element {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .section.hidden { display: none; }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3), 0 0 10px rgba(255, 255, 255, 0.2); }
            to { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.4); }
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.3rem;
            font-weight: 300;
        }

        h1, h2, h3 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.5rem; text-align: center; }
        h2 { font-size: 1.8rem; color: #764ba2; }
        h3 { font-size: 1.3rem; }

        p, li {
            color: #555;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .highlight {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.3);
            text-align: center;
            font-weight: bold;
        }

        .info-box {
            background: rgba(103, 126, 234, 0.1);
            border-left: 5px solid #667eea;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 15px 15px 0;
            backdrop-filter: blur(5px);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-back {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .btn-back:hover {
            box-shadow: 0 15px 35px rgba(108, 117, 125, 0.4);
        }

        .btn-primary {
            flex: 1;
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }

        .btn:hover::before {
            animation: shine 0.6s ease-in-out;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 1rem;
            color: #333;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .radio-group, .checkbox-group {
            display: grid;
            gap: 1rem;
            margin-left: 1rem;
        }

        .radio-group label, .checkbox-group label {
            font-weight: normal;
            cursor: pointer;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: rgba(248, 249, 250, 0.8);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
        }

        .radio-group label:hover, .checkbox-group label:hover {
            background: rgba(103, 126, 234, 0.1);
            border-color: rgba(103, 126, 234, 0.3);
            transform: translateX(5px);
        }

        input[type="radio"], input[type="checkbox"] {
            margin-right: 1rem;
            transform: scale(1.3);
            cursor: pointer;
        }

        .age-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }

        .zoo-entrance {
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.95) 100%);
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        .zoo-entrance::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .zoo-gate {
            font-size: 6rem;
            margin: 2rem 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        .enter-zoo-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            font-size: 1.3rem;
            padding: 1.5rem 3rem;
            margin: 2rem;
            animation: pulse 2s infinite;
        }

        .enter-zoo-btn:hover {
            box-shadow: 0 20px 40px rgba(40, 167, 69, 0.4);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .zoo-encounter {
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.95) 100%);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .animal-image {
            max-width: 400px;
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
        }

        .animal-image:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .donation-section {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 3px solid rgba(103, 126, 234, 0.1);
        }

        .slider-container {
            margin: 2rem 0;
            position: relative;
        }

        .slider {
            width: 100%;
            height: 15px;
            border-radius: 8px;
            background: linear-gradient(to right, #e9ecef 0%, #667eea 100%);
            outline: none;
            -webkit-appearance: none;
            margin: 1.5rem 0;
            position: relative;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.3);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.6);
        }

        .slider::-moz-range-thumb {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .slider-values {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            color: #666;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .donation-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.3);
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.3);
            height: 15px;
            border-radius: 8px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            height: 100%;
            width: 0%;
            transition: width 0.6s ease;
            border-radius: 8px;
        }

        .progress-text {
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .likert-scale {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin: 2rem 0;
            text-align: center;
        }

        .likert-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 1rem;
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(248, 249, 250, 0.8);
            border: 2px solid transparent;
        }

        .likert-item:hover {
            background: rgba(103, 126, 234, 0.1);
            border-color: rgba(103, 126, 234, 0.3);
            transform: translateY(-5px);
        }

        .likert-item input[type="radio"] {
            margin-bottom: 1rem;
            transform: scale(1.5);
        }

        .likert-item label {
            font-size: 0.9rem;
            font-weight: normal;
            text-align: center;
            line-height: 1.3;
        }

        .attention-check-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .attention-image-item {
            text-align: center;
            padding: 1.5rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(248, 249, 250, 0.8);
            border: 3px solid transparent;
        }

        .attention-image-item:hover {
            background: rgba(103, 126, 234, 0.1);
            border-color: rgba(103, 126, 234, 0.3);
            transform: translateY(-8px);
        }

        .attention-image-item img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .attention-image-item:hover img {
            transform: scale(1.05);
        }

        .error-message {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
            text-align: center;
            font-weight: bold;
            animation: shake 0.6s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .success-message {
            background: linear-gradient(135deg, #51cf66 0%, #69db7c 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            text-align: center;
            font-weight: bold;
        }

        .thank-you-page {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            color: white;
        }

        .thank-you-page h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 2rem;
        }

        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(103, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(103, 126, 234, 0.2);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }

        /* Loading spinner for data submission */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2.2rem; }
            .section { padding: 1.5rem; }
            .likert-scale { grid-template-columns: 1fr; gap: 1rem; }
            .attention-check-grid { grid-template-columns: 1fr; }
            .animal-image { max-width: 100%; height: 280px; }
            .stats-display { grid-template-columns: 1fr; }
            .navigation-buttons { flex-direction: column; }
            .age-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="floating-element" style="top: 15%; left: 10%; animation-delay: 0s;">ü¶Å</div>
        <div class="floating-element" style="top: 25%; right: 15%; animation-delay: 1.5s;">üêß</div>
        <div class="floating-element" style="top: 65%; left: 20%; animation-delay: 3s;">üêô</div>
        <div class="floating-element" style="top: 75%; right: 25%; animation-delay: 4.5s;">üêµ</div>
        <div class="floating-element" style="top: 45%; left: 60%; animation-delay: 6s;">ü¶í</div>
        <div class="floating-element" style="top: 35%; right: 40%; animation-delay: 7.5s;">üê†</div>
    </div>

    <div class="container">
        <!-- Study Header -->
        <div class="header">
            <h1>ü¶Å Virtual Zoo Research Study ü¶Å</h1>
            <p>Kindchenschema and Kindness: The Role of Cuteness in Prosocial Behaviour</p>
        </div>

        <!-- 1. Informed Consent -->
        <div class="section" id="informed-consent">
            <h1>üìã Informed Consent</h1>
            <p><strong>Dear Participant,</strong></p>
            <p>Welcome to participate in the study titled <strong>"Kindchenschema and Kindness: The Role of Cuteness in Prosocial Behaviour"</strong>. Should you have any questions regarding this study, feel free to direct them to the researcher. The details are available in this consent form.</p>

            <h3>üî¨ Description of the project:</h3>
            <p>This study aims to investigate the effect of cuteness on prosocial behaviour. To take part in this study, you must age between 18 and 25 years old. In addition, you should not have any visionary problems.</p>

            <h3>üìù What will be done:</h3>
            <p>If you agree to participate in this study, you will need to fill in an informed consent form to indicate your voluntary participation. Moving on, you will need to fill in a demographic form to indicate that you are eligible to participate in the current study. Next, you will need to complete the Dictator Game, a task designed to measure your prosocial behaviour. The entire study will take no longer than 30 minutes to complete.</p>

            <h3>‚ö†Ô∏è Risks or discomfort:</h3>
            <p>There is no foreseeable risk or discomfort from this study. If you find your participation in this study has caused you to experience any psychological harm, you may contact the Centre for Psychological and Counselling Services (CPCS) at cpcs.hu@help.edu.my or dial 03-78493200 to make an appointment or visit any reputable counselling centres near you. Please note that CPCS sees clients only on an appointment basis.</p>
            
            <div class="info-box">
                <strong>Centre for Psychological & Counselling Services (CPCS)</strong><br>
                Level 6, Block B,<br>
                HELP University Subang 2,<br>
                Persiaran Cakerawala, Seksyen U4,<br>
                40150 Shah Alam, Selangor.<br>
                Tel: 03-7849 3200<br>
                Email: cpcs.hu@help.edu.my
            </div>

            <h3>üéÅ Benefits of this study:</h3>
            <p>There will be some compensation for participating in this study. In addition, your participation will help advance the current understanding of the effect of cuteness on prosocial behaviour.</p>

            <h3>üîí Confidentiality:</h3>
            <p>We will take every effort to ensure that any information collected from you remains confidential. Only the researcher and the researcher's supervisor will be able to access the information gathered.</p>

            <h3>üö™ Decision to quit at any time:</h3>
            <p>Participation in this study is voluntary based. You reserve the right to withdraw at any time, with no adverse actions being implemented. If you wish to terminate participation, please exit the Google Form without submitting your responses.</p>

            <h3>üìã Rights and complaints:</h3>
            <p>This study has been reviewed and approved by the Ethics Review Board, Department of Psychology, Faculty of Behavioural Sciences at HELP University [ERB Approval Code: ].</p>
            
            <div class="info-box">
                <strong>Chairperson, Ethics Review Board</strong><br>
                Department of Psychology<br>
                Faculty of Behavioural Sciences<br>
                Level 3, Block B HELP University ‚Äì Subang 2<br>
                Persiaran Cakerawala, Seksyen U4<br>
                40150 Shah Alam<br>
                Selangor Darul Ehsan Malaysia<br>
                Email: psych.erb@help.edu.my<br>
                Phone: +603 7849 3000
            </div>

            <p>For any enquiries about this particular study, please feel free to contact the researcher:</p>
            <div class="info-box">
                <strong>Researcher:</strong> Yong Zi Yu - B2100815@helplive.edu.my<br>
                <strong>Research Supervisor:</strong> Ms. Khor Khai Ling - khailing.k@help.edu.my
            </div>

            <div class="highlight">
                <h3>‚úÖ By clicking the button below, you acknowledge:</h3>
                <p>Your participation in the study is voluntary.</p>
            </div>

            <div class="navigation-buttons" style="justify-content: center; gap: 2rem;">
                <button class="btn btn-primary" onclick="proceedToSection('demographics')">I consent</button>
                <button class="btn btn-back" onclick="proceedToSection('thank-you')">Do not consent</button>
            </div>
        </div>

        <!-- 2. Demographics Form -->
        <div class="section hidden" id="demographics">
            <h1>üë§ Demographic Information</h1>
            <p>Please provide the following information to determine your eligibility for this study.</p>

            <div class="form-group">
                <label>üéÇ What is your age?</label>
                <div class="radio-group age-grid">
                    <label><input type="radio" name="age" value="18"> 18</label>
                    <label><input type="radio" name="age" value="19"> 19</label>
                    <label><input type="radio" name="age" value="20"> 20</label>
                    <label><input type="radio" name="age" value="21"> 21</label>
                    <label><input type="radio" name="age" value="22"> 22</label>
                    <label><input type="radio" name="age" value="23"> 23</label>
                    <label><input type="radio" name="age" value="24"> 24</label>
                    <label><input type="radio" name="age" value="25"> 25</label>
                    <label><input type="radio" name="age" value="others"> Others</label>
                </div>
            </div>

            <div class="form-group">
                <label>üë• What is your gender?</label>
                <div class="radio-group">
                    <label><input type="radio" name="gender" value="male"> Male</label>
                    <label><input type="radio" name="gender" value="female"> Female</label>
                    <label><input type="radio" name="gender" value="non-binary"> Non-binary/Third gender</label>
                    <label><input type="radio" name="gender" value="prefer-not-to-say"> Prefer not to say</label>
                </div>
            </div>

            <div class="form-group">
                <label>üåç What is your nationality?</label>
                <div class="radio-group">
                    <label><input type="radio" name="nationality" value="malaysian"> Malaysian</label>
                    <label><input type="radio" name="nationality" value="non-malaysian"> Non-Malaysian</label>
                </div>
            </div>

            <div class="form-group">
                <label>üëÅÔ∏è Vision Conditions</label>
                <p style="font-size: 1rem; color: #666; margin-bottom: 1rem;">
                    Do you have any vision-related conditions that may affect your ability to view images clearly (e.g., myopia, astigmatism, short-sightedness, long-sightedness, blurry vision, colour blindness, etc)?<br><br>
                    <em>*Corrected vision = You have a vision issue, but you wear glasses or contact lenses that help you see clearly</em><br>
                    <em>*Uncorrected vision = You have a vision issue, but you don't wear glasses or contact lenses, so your vision is still blurry or unclear</em>
                </p>
                <div class="radio-group">
                    <label><input type="radio" name="vision" value="no-condition"> ‚úÖ No, I don't have any vision-related condition</label>
                    <label><input type="radio" name="vision" value="corrected"> üëì Yes, but corrected with glasses or contact lenses</label>
                    <label><input type="radio" name="vision" value="uncorrected"> ‚ùå Yes, uncorrected</label>
                    <label><input type="radio" name="vision" value="prefer-not-to-say"> ü§ê Prefer not to say</label>
                </div>
            </div>

            <div id="demographics-error" class="error-message hidden"></div>

            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="proceedToSection('informed-consent')">‚¨ÖÔ∏è Back</button>
                <button class="btn btn-primary" onclick="validateDemographics()">‚úÖ Continue to Study</button>
            </div>
        </div>

        <!-- 3. Zoo Entrance -->
        <div class="section hidden" id="zoo-entrance">
            <div class="zoo-entrance">
                <h1 style="color: #6B7EF7; font-size: 3rem; margin-bottom: 2rem;">üé™ Welcome to Our Virtual Zoo! üé™</h1>
                <div class="zoo-gate" style="font-size: 2.5rem; line-height: 1.4; margin: 3rem 0; display: flex; flex-direction: column; align-items: center;">
                    <div style="margin-bottom: 1rem;">üå≥ ü¶Å üåø</div>
                    <div style="display: flex; align-items: center; margin: 1rem 0;">
                        üö™ <span style="font-size: 3rem; font-weight: bold; color: #333; margin: 0 1rem;">ZOO<br>ENTRANCE</span> üö™
                    </div>
                    <div style="margin-top: 1rem;">üåø üêß üå≥</div>
                </div>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">You're about to embark on an amazing virtual zoo adventure!</p>
                
                <div class="highlight">
                    <h3>üéØ How the Virtual Zoo Works:</h3>
                    <p>‚Ä¢ Every time you visit an animal, there is a <strong>RM10 visiting fee</strong></p>
                    <p>‚Ä¢ You can use this RM10 to buy food for the animal (in the range of <strong>RM0.00 to RM10.00</strong>)</p>
                    <p>‚Ä¢ OR skip buying food, and the RM10 will be kept for you and returned at the end</p>
                    <p>‚Ä¢ You'll see several animals and make this choice for each one</p>
                    <p>‚Ä¢ <strong>There are no right or wrong answers</strong> - just decide based on how you feel!</p>
                </div>

                <p style="font-size: 1.1rem; color: #666;">After finishing all the animals, we'll show the total amount you "spent" on the animals.</p>
                
                <div class="highlight" style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%); margin-top: 1rem;">
                    <p style="font-size: 1.1rem; font-weight: bold;">‚ö†Ô∏è Please treat it as if it were real, as you might need to pay the amount in the end.</p>
                </div>

                <button class="btn enter-zoo-btn" onclick="startDictatorGame()">üö™ Enter Zoo</button>
            </div>

            <div class="navigation-buttons" style="margin-top: 2rem;">
                <button class="btn btn-back" onclick="proceedToSection('demographics')">‚¨ÖÔ∏è Back</button>
            </div>
        </div>

        <!-- 4. Progress Tracker -->
        <div class="progress-container hidden" id="progress-container">
            <div class="progress-text">Animal <span id="current-animal">1</span> of 14</div>
            <div class="progress-bar">
                <div class="progress-fill" id="game-progress"></div>
            </div>
        </div>

        <!-- 5. Zoo Encounter -->
        <div class="section hidden" id="zoo-encounter">
            <div class="zoo-encounter">
                <img id="animal-image" class="animal-image" src="" alt="Animal">
                
                <h2>üêæ Meet this wonderful animal!</h2>
                
                <div class="donation-section">
                    <h3>üíù How much would you like to donate?</h3>
                    <p style="font-size: 1.1rem;">In the range of RM0.00 to RM10.00, decide how much you willing to donate it to the animal for its food, shelter, or medical care.</p>
                    
                    <div class="slider-container">
                        <input type="range" min="0" max="1000" value="0" class="slider" id="donation-slider">
                        <div class="slider-values">
                            <span>RM 0.00</span>
                            <span>RM 10.00</span>
                        </div>
                    </div>

                    <div class="donation-display">
                        Amount you spent for the animal: <span id="donation-amount">RM 0.00</span><br>
                        Amount You Keep: <span id="keep-amount">RM 10.00</span>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="nextAnimal()" id="next-animal-btn">Visit the next animal</button>
            </div>

            <div class="navigation-buttons" style="margin-top: 2rem;">
                <button class="btn btn-back" onclick="goBackFromAnimal()">‚¨ÖÔ∏è Back</button>
            </div>
        </div>

        <!-- 6. Zoo Visit Summary -->
        <div class="section hidden" id="zoo-summary">
            <h1>üìä Your Zoo Visit Summary</h1>
            <div style="text-align: center;">
                <div style="font-size: 4rem; margin: 2rem 0;">ü¶Åüêßüêæü¶í</div>
                <h2>üéâ Congratulations! You've visited all 14 animals!</h2>
                
                <div class="stats-display">
                    <div class="stat-card">
                        <div class="stat-number" id="summary-total-donated">RM 0.00</div>
                        <div class="stat-label">Total Amount Donated to Animals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="summary-total-kept">RM 140.00</div>
                        <div class="stat-label">Total Amount You Kept</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">14</div>
                        <div class="stat-label">Animals Visited</div>
                    </div>
                </div>
                
                <div class="highlight">
                    <h3>üîç What's Next?</h3>
                    <p>Now we'll ask you a few more questions about your experience with the animals.</p>
                    <p>This will help us understand your thoughts about the zoo visit!</p>
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="goBackToZoo()">‚¨ÖÔ∏è Back to Zoo</button>
                <button class="btn btn-primary" onclick="setupManipulationCheckFromSummary()">‚úÖ Continue</button>
            </div>
        </div>

        <!-- 7. Manipulation Check -->
        <div class="section hidden" id="manipulation-check">
            <h1>‚≠ê Animal Cuteness Rating</h1>
            <p>Please rate how cute you found each animal on a scale from 1 (not cute at all) to 7 (extremely cute).</p>
            
            <div id="manipulation-questions"></div>
            
            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="goBackToZoo()">‚¨ÖÔ∏è Back to Zoo</button>
                <button class="btn btn-primary" onclick="proceedToSection('attention-check')" id="manipulation-continue" disabled>‚úÖ Continue</button>
            </div>
        </div>

        <!-- 7. Attention Check -->
        <div class="section hidden" id="attention-check">
            <h1>üéØ Attention Check</h1>
            <p>Please select all the animals that were presented to you in the zoo visit task. Select as many as you think are correct:</p>
            
            <div class="attention-check-grid">
                <div class="attention-image-item">
                    <img src="https://i.imgur.com/kE9U8g1.png" alt="Animal 1">
                    <label><input type="checkbox" name="attention" value="1"> ‚úÖ I saw this animal</label>
                </div>
                <div class="attention-image-item">
                    <img src="https://i.imgur.com/dig6OlQ.png" alt="Animal 2">
                    <label><input type="checkbox" name="attention" value="2"> ‚úÖ I saw this animal</label>
                </div>
                <div class="attention-image-item">
                    <img src="https://i.imgur.com/xaxASmm.png" alt="Animal 3">
                    <label><input type="checkbox" name="attention" value="3"> ‚úÖ I saw this animal</label>
                </div>
                <div class="attention-image-item">
                    <img src="https://i.imgur.com/JBSsw5g.png" alt="Animal 4">
                    <label><input type="checkbox" name="attention" value="4"> ‚úÖ I saw this animal</label>
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="proceedToSection('manipulation-check')">‚¨ÖÔ∏è Back</button>
                <button class="btn btn-primary" onclick="proceedToSection('validity-test')" id="attention-continue">üîç Continue</button>
            </div>
        </div>

        <!-- 8. Validity Test -->
        <div class="section hidden" id="validity-test">
            <h1>ü§î Understanding Check</h1>
            <p>What are the requirements for the task? (Select all that applies)</p>
            
            <div class="checkbox-group">
                <label><input type="checkbox" name="validity" value="correct1"> ‚úÖ The amount that I indicate on the slider is the amount will be given to the animal recipient</label>
                <label><input type="checkbox" name="validity" value="incorrect1"> ‚ùå The amount that I indicate on the slider is the amount that I wish to keep for myself</label>
                <label><input type="checkbox" name="validity" value="incorrect2"> ‚ùå I only have RM10 to donate throughout the study</label>
                <label><input type="checkbox" name="validity" value="correct2"> ‚úÖ I have RM10 to donate to each of the animal</label>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="proceedToSection('attention-check')">‚¨ÖÔ∏è Back</button>
                <button class="btn btn-primary" onclick="proceedToSection('debriefing')" id="validity-continue">üìù Continue</button>
            </div>
        </div>

        <!-- 9. Debriefing -->
        <div class="section hidden" id="debriefing">
            <h1>üìä Study Debriefing</h1>
            <p><strong>üôè Thank you for taking part in this study!</strong></p>
            
            <p>This research aimed to explore how seeing cute versus non-cute animals might influence prosocial behaviour. In this case, how much money you chose to share in each round of the game.</p>
            
            <div class="highlight">
                <h3>üîç Important Disclosure:</h3>
                <p>To make sure your responses were genuine, we told you that your decisions could affect a real payout. However, this was not actually the case as <strong>no real money was involved and you no need to pay anything</strong>. This small deception was deemed necessary to prevent participants from making artificially generous choices, which could have compromised the validity of the findings.</p>
            </div>
            
            <p>However, your participation will help advance the current understanding of the effect of cuteness on prosocial behaviour.</p>
            
            <p>We understand that this may cause some discomfort, and we assure you that all data will be kept confidential and used strictly for academic purposes. If you feel uncomfortable and wish to withdraw your data, you may do so by not submitting this form.</p>
            
            <p>You have the right to withdraw your participation and request that your data be removed from the study without any penalty.</p>
            
            <p>The use of deception was reviewed and approved by the Ethics Review Board of HELP University. Should you have any questions or concerns, or wish to withdraw your participation, please email:</p>
            
            <div class="info-box">
                <strong>üìû Contact Information:</strong><br>
                <strong>Researcher:</strong> Yong Zi Yu ‚Äì B2100815@helplive.edu.my<br>
                <strong>Supervisor:</strong> Ms. Khor Khai Ling ‚Äì khailing.k@help.edu.my<br>
                <strong>Ethics Review Board:</strong> psych.erb@help.edu.my
            </div>
            
            <p><strong>Thank you again for your participation!</strong></p>

            <div class="form-group">
                <label style="font-size: 1.1rem; color: #667eea; background: rgba(103, 126, 234, 0.1); padding: 1rem; border-radius: 10px;">
                    <input type="checkbox" id="final-consent"> ‚úÖ I understand that no real money will be given or received in this study, and I willingly choose to participate in this study
                </label>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-back" onclick="proceedToSection('validity-test')">‚¨ÖÔ∏è Back</button>
                <button class="btn btn-primary" onclick="completeStudy()" id="complete-study-btn" disabled>üéâ Complete Study</button>
            </div>
        </div>

        <!-- Thank You Page -->
        <div class="section hidden" id="thank-you">
            <div class="thank-you-page">
                <h1>üôè Thank You</h1>
                <p style="font-size: 1.3rem;">Thank you for your interest in our research study.</p>
                <p>Your time is valuable, and we appreciate your consideration.</p>
                <div style="font-size: 4rem; margin: 2rem 0;">ü¶Åüêßüê∏ü¶í</div>
            </div>
        </div>

        <!-- Study Complete -->
        <div class="section hidden" id="study-complete">
            <div style="text-align: center;">
                <h1>üéâ Study Complete! üéâ</h1>
                <div style="font-size: 4rem; margin: 2rem 0;">ü¶Åüêßüê∏ü¶íüêôü¶ã</div>
                <div class="success-message">
                    <h2>Thank you for your valuable participation!</h2>
                    <p>Your responses have been recorded successfully and will contribute to important research on cuteness and prosocial behavior.</p>
                </div>
                
                <div class="stats-display">
                    <div class="stat-card">
                        <div class="stat-number" id="total-donated">RM 0.00</div>
                        <div class="stat-label">Total Donated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">14</div>
                        <div class="stat-label">Animals Visited</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">üåü</div>
                        <div class="stat-label">Study Completed</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="restartStudy()">üîÑ Take Study Again</button>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script URL for data submission
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwmnu6GBFlqoJwFqVTG4RiT7GWnG33lXs6CUCPlsexRZKbVS6n5gBHVvvdiwMQ1A6IF/exec';

        // Animal images in the specified order from the study
        const animalImages = [
            "https://i.imgur.com/unjRTSV.png", // Baby puppy
            "https://i.imgur.com/xaxASmm.png", // Adult dog
            "https://i.imgur.com/q13LDoX.png", // Baby kitten
            "https://i.imgur.com/i2d5sZ5.png", // Adult cat
            "https://i.imgur.com/kE9U8g1.png", // Baby fawn
            "https://i.imgur.com/kmrTXme.png", // Adult deer
            "https://i.imgur.com/WOhBZZV.png", // Baby penguin
            "https://i.imgur.com/O3hxUdz.png", // Adult penguin
            "https://i.imgur.com/dig6OlQ.png", // Baby seal
            "https://i.imgur.com/zIz8RP9.png", // Adult seal
            "https://i.imgur.com/2znBUTL.png", // Baby elephant
            "https://i.imgur.com/QUc65Uq.png", // Adult elephant
            "https://i.imgur.com/02BYRRJ.png", // Baby squirrel
            "https://i.imgur.com/MqRuE18.png"  // Adult squirrel
        ];

        let currentAnimalIndex = 0;
        let donations = [];
        let manipulationRatings = [];
        let attentionCheckData = [];
        let validityTestData = [];
        let totalDonated = 0;
        let sectionHistory = [];
        let participantId = null;

        // Initialize floating elements and slider
        document.addEventListener('DOMContentLoaded', function() {
            participantId = generateParticipantId();
            animateFloatingElements();
            initializeSlider();
            setupEventListeners();
        });

        function generateParticipantId() {
            return Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function animateFloatingElements() {
            const elements = document.querySelectorAll('.floating-element');
            elements.forEach((element, index) => {
                setInterval(() => {
                    const randomX = Math.random() * (window.innerWidth - 100);
                    const randomY = Math.random() * (window.innerHeight - 100);
                    element.style.transition = 'all 6s ease-in-out';
                    element.style.left = randomX + 'px';
                    element.style.top = randomY + 'px';
                }, 10000 + index * 2000);
            });
        }

        function initializeSlider() {
            const slider = document.getElementById('donation-slider');
            if (slider) {
                slider.addEventListener('input', updateDonationDisplay);
            }
        }

        function setupEventListeners() {
            // Final consent checkbox
            setTimeout(() => {
                const finalConsent = document.getElementById('final-consent');
                const completeBtn = document.getElementById('complete-study-btn');
                
                if (finalConsent && completeBtn) {
                    finalConsent.addEventListener('change', function() {
                        completeBtn.disabled = !this.checked;
                    });
                }
            }, 1000);

            // Attention check - any selection enables continue
            document.addEventListener('change', function(e) {
                if (e.target.name === 'attention') {
                    const anyChecked = document.querySelector('input[name="attention"]:checked');
                    document.getElementById('attention-continue').disabled = !anyChecked;
                }
                if (e.target.name && e.target.name.startsWith('validity')) {
                    const anyChecked = document.querySelector('input[name="validity"]:checked');
                    document.getElementById('validity-continue').disabled = !anyChecked;
                }
            });
        }

        function proceedToSection(sectionId) {
            // Add current section to history for back navigation
            const currentSection = document.querySelector('.section:not(.hidden)')?.id;
            if (currentSection && currentSection !== sectionId) {
                sectionHistory.push(currentSection);
            }

            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Show/hide progress container
            if (sectionId === 'zoo-encounter' || sectionId === 'manipulation-check') {
                document.getElementById('progress-container').classList.remove('hidden');
            } else {
                document.getElementById('progress-container').classList.add('hidden');
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function validateDemographics() {
            const age = document.querySelector('input[name="age"]:checked')?.value;
            const vision = document.querySelector('input[name="vision"]:checked')?.value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            const nationality = document.querySelector('input[name="nationality"]:checked')?.value;

            if (!age || !vision || !gender || !nationality) {
                showError('demographics-error', '‚ö†Ô∏è Please answer all demographic questions before continuing.');
                return;
            }

            // Check exclusion criteria: age not 18-25 OR vision uncorrected OR prefer not to say
            const validAges = ['18', '19', '20', '21', '22', '23', '24', '25'];
            if (!validAges.includes(age) || vision === 'uncorrected' || vision === 'prefer-not-to-say') {
                proceedToSection('thank-you');
                return;
            }

            proceedToSection('zoo-entrance');
        }

        function startDictatorGame() {
            proceedToSection('zoo-encounter');
            showCurrentAnimal();
        }

        function showCurrentAnimal() {
            document.getElementById('animal-image').src = animalImages[currentAnimalIndex];
            document.getElementById('current-animal').textContent = currentAnimalIndex + 1;
            
            // Reset slider to 0
            document.getElementById('donation-slider').value = 0;
            updateDonationDisplay();
            
            // Update progress bar
            const progress = (currentAnimalIndex / animalImages.length) * 100;
            document.getElementById('game-progress').style.width = progress + '%';
            
            // Animal entrance animation
            const img = document.getElementById('animal-image');
            img.style.transform = 'scale(0.8)';
            img.style.opacity = '0';
            setTimeout(() => {
                img.style.transition = 'all 0.6s ease';
                img.style.transform = 'scale(1)';
                img.style.opacity = '1';
            }, 100);
        }

        function updateDonationDisplay() {
            const slider = document.getElementById('donation-slider');
            const donationAmount = (slider.value / 100).toFixed(2);
            const keepAmount = (10 - donationAmount).toFixed(2);
            
            document.getElementById('donation-amount').textContent = `RM ${donationAmount}`;
            document.getElementById('keep-amount').textContent = `RM ${keepAmount}`;
        }

        function nextAnimal() {
            const donationAmount = parseFloat((document.getElementById('donation-slider').value / 100).toFixed(2));
            donations.push({
                animal: currentAnimalIndex + 1,
                imageUrl: animalImages[currentAnimalIndex],
                donation: donationAmount,
                kept: parseFloat((10 - donationAmount).toFixed(2))
            });
            
            totalDonated += donationAmount;
            currentAnimalIndex++;
            
            if (currentAnimalIndex >= animalImages.length) {
                showZooSummary();
            } else {
                showCurrentAnimal();
            }
        }

        function showZooSummary() {
            const totalKept = (animalImages.length * 10) - totalDonated;
            
            document.getElementById('summary-total-donated').textContent = `RM ${totalDonated.toFixed(2)}`;
            document.getElementById('summary-total-kept').textContent = `RM ${totalKept.toFixed(2)}`;
            
            proceedToSection('zoo-summary');
        }

        function setupManipulationCheckFromSummary() {
            setupManipulationCheck();
            proceedToSection('manipulation-check');
        }

        function setupManipulationCheck() {
            const container = document.getElementById('manipulation-questions');
            container.innerHTML = '';

            animalImages.forEach((imageUrl, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'zoo-encounter';
                questionDiv.style.marginBottom = '3rem';
                
                questionDiv.innerHTML = `
                    <img src="${imageUrl}" class="animal-image" alt="Animal ${index + 1}" style="max-width: 250px; height: 250px;">
                    <h3>üåü How cute is this animal?</h3>
                    <div class="likert-scale">
                        ${[1,2,3,4,5,6,7].map(value => `
                            <div class="likert-item">
                                <input type="radio" name="cuteness-${index}" value="${value}" id="cute-${index}-${value}">
                                <label for="cute-${index}-${value}">${
                                    value === 1 ? 'Not cute<br>at all' : 
                                    value === 2 ? 'Slightly<br>cute' :
                                    value === 3 ? 'Somewhat<br>cute' :
                                    value === 4 ? 'Moderately<br>cute' :
                                    value === 5 ? 'Quite<br>cute' :
                                    value === 6 ? 'Very<br>cute' :
                                    'Extremely<br>cute'
                                }</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });

            // Update continue button based on completion
            const continueBtn = document.getElementById('manipulation-continue');
            
            function checkAllAnswered() {
                let allAnswered = true;
                let answeredCount = 0;
                for (let i = 0; i < animalImages.length; i++) {
                    if (document.querySelector(`input[name="cuteness-${i}"]:checked`)) {
                        answeredCount++;
                    } else {
                        allAnswered = false;
                    }
                }
                continueBtn.disabled = !allAnswered;
                continueBtn.textContent = allAnswered ? '‚úÖ Continue' : `‚úÖ Continue (${answeredCount}/${animalImages.length} rated)`;
            }

            container.addEventListener('change', checkAllAnswered);
            checkAllAnswered();
        }

        function goBackFromAnimal() {
            if (currentAnimalIndex > 0) {
                currentAnimalIndex--;
                // Remove the last donation
                if (donations.length > 0) {
                    const lastDonation = donations.pop();
                    totalDonated -= lastDonation.donation;
                }
                showCurrentAnimal();
            } else {
                proceedToSection('zoo-entrance');
            }
        }

        function goBackToZoo() {
            // Go back to the last animal
            currentAnimalIndex = animalImages.length - 1;
            proceedToSection('zoo-encounter');
            showCurrentAnimal();
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            if (container) {
                container.textContent = message;
                container.classList.remove('hidden');
                
                setTimeout(() => {
                    container.classList.add('hidden');
                }, 5000);
            }
        }

        // Function to collect all study data
        function collectStudyData() {
            // Collect manipulation check ratings
            manipulationRatings = [];
            for (let i = 0; i < animalImages.length; i++) {
                const rating = document.querySelector(`input[name="cuteness-${i}"]:checked`)?.value;
                if (rating) {
                    manipulationRatings.push({
                        animal: i + 1,
                        imageUrl: animalImages[i],
                        cuteness: parseInt(rating)
                    });
                }
            }

            // Collect attention check data
            attentionCheckData = Array.from(document.querySelectorAll('input[name="attention"]:checked'))
                .map(el => el.value);

            // Collect validity test data
            validityTestData = Array.from(document.querySelectorAll('input[name="validity"]:checked'))
                .map(el => el.value);

            // Prepare comprehensive study data
            const studyData = {
                // Basic info
                participant_id: participantId,
                timestamp: new Date().toISOString(),
                study_start_time: new Date(studyStartTime).toISOString(),
                study_completion_time: new Date().toISOString(),
                study_duration_minutes: Math.round((Date.now() - studyStartTime) / 60000),
                
                // Demographics
                age: document.querySelector('input[name="age"]:checked')?.value || '',
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                nationality: document.querySelector('input[name="nationality"]:checked')?.value || '',
                vision_condition: document.querySelector('input[name="vision"]:checked')?.value || '',
                
                // Donation behavior summary
                total_donated: totalDonated.toFixed(2),
                total_kept: (140 - totalDonated).toFixed(2),
                average_donation: (totalDonated / 14).toFixed(2),
                
                // Individual animal donations (flatten for Google Sheets)
                ...donations.reduce((acc, donation, index) => {
                    acc[`animal_${index + 1}_donation`] = donation.donation;
                    acc[`animal_${index + 1}_image_url`] = donation.imageUrl;
                    return acc;
                }, {}),
                
                // Individual cuteness ratings (flatten for Google Sheets)
                ...manipulationRatings.reduce((acc, rating, index) => {
                    acc[`animal_${rating.animal}_cuteness`] = rating.cuteness;
                    return acc;
                }, {}),
                
                // Attention check
                attention_check_selections: attentionCheckData.join(','),
                attention_check_count: attentionCheckData.length,
                
                // Validity test
                validity_test_selections: validityTestData.join(','),
                validity_correct1: validityTestData.includes('correct1') ? 'Yes' : 'No',
                validity_correct2: validityTestData.includes('correct2') ? 'Yes' : 'No',
                validity_incorrect1: validityTestData.includes('incorrect1') ? 'Yes' : 'No',
                validity_incorrect2: validityTestData.includes('incorrect2') ? 'Yes' : 'No',
                validity_test_passed: (validityTestData.includes('correct1') && validityTestData.includes('correct2')) ? 'Yes' : 'No',
                
                // Final consent
                final_consent_given: document.getElementById('final-consent')?.checked ? 'Yes' : 'No',
                study_completed: 'Yes',
                completion_status: 'completed',
                
                // Raw data arrays (for backup/detailed analysis)
                raw_donations: JSON.stringify(donations),
                raw_cuteness_ratings: JSON.stringify(manipulationRatings),
                raw_attention_data: JSON.stringify(attentionCheckData),
                raw_validity_data: JSON.stringify(validityTestData)
            };
            
            return studyData;
        }

        // Function to submit data to Google Sheets
        async function submitDataToGoogleSheets(data) {
            const submitBtn = document.getElementById('complete-study-btn');
            const originalText = submitBtn.innerHTML;
            
            try {
                // Show loading state
                submitBtn.innerHTML = '<span class="loading-spinner"></span>Saving your data...';
                submitBtn.disabled = true;
                
                console.log('üì§ Submitting data to Google Sheets:', data);
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                // Note: With no-cors mode, we can't read the response
                // But if we get here without error, the request was sent
                console.log('‚úÖ Data submitted successfully');
                return true;
                
            } catch (error) {
                console.error('‚ùå Error submitting data:', error);
                
                // Show error state
                submitBtn.innerHTML = '‚ö†Ô∏è Error - Try Again';
                submitBtn.disabled = false;
                
                // Show error message to user
                showError('debriefing', 'There was an error saving your data. Please try clicking "Complete Study" again. Your responses are still saved locally.');
                
                return false;
            }
        }

        async function completeStudy() {
            // Collect all study data
            const studyData = collectStudyData();
            
            // Submit to Google Sheets
            const submissionSuccess = await submitDataToGoogleSheets(studyData);
            
            // Always proceed to completion page (data is collected regardless)
            // Display final stats
            document.getElementById('total-donated').textContent = `RM ${totalDonated.toFixed(2)}`;

            // Log complete study data to console (backup)
            console.log('üìä STUDY COMPLETE - Data Collected:', studyData);

            proceedToSection('study-complete');
        }

        function restartStudy() {
            // Reset all variables
            currentAnimalIndex = 0;
            donations = [];
            manipulationRatings = [];
            attentionCheckData = [];
            validityTestData = [];
            totalDonated = 0;
            sectionHistory = [];
            participantId = generateParticipantId();
            
            // Reset all form inputs
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    input.checked = false;
                } else if (input.type === 'range') {
                    input.value = 0;
                }
            });
            
            // Reset progress
            document.getElementById('game-progress').style.width = '0%';
            
            proceedToSection('informed-consent');
        }

        // Track study start time
        const studyStartTime = Date.now();

        // Prevent accidental page refresh during study
        window.addEventListener('beforeunload', function(e) {
            const currentSection = document.querySelector('.section:not(.hidden)')?.id;
            if (currentSection && currentSection !== 'informed-consent' && currentSection !== 'study-complete' && currentSection !== 'thank-you') {
                e.preventDefault();
                e.returnValue = 'You are in the middle of the study. Are you sure you want to leave?';
            }
        });

        // Additional utility functions for data analysis
        function calculateBabyVsAdultDonations() {
            const babyAnimals = [0, 2, 4, 6, 8, 10, 12]; // Indices of baby animals
            const adultAnimals = [1, 3, 5, 7, 9, 11, 13]; // Indices of adult animals
            
            let babyDonations = 0;
            let adultDonations = 0;
            
            donations.forEach((donation, index) => {
                if (babyAnimals.includes(index)) {
                    babyDonations += donation.donation;
                } else {
                    adultDonations += donation.donation;
                }
            });
            
            return {
                babyDonations: babyDonations.toFixed(2),
                adultDonations: adultDonations.toFixed(2),
                babyCutenessEffect: babyDonations - adultDonations
            };
        }

        // Export data function (for researchers)
        function exportStudyDataAsCSV() {
            const data = collectStudyData();
            const csvContent = "data:text/csv;charset=utf-8," 
                + Object.keys(data).join(",") + "\n"
                + Object.values(data).join(",");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `zoo_study_${participantId}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Add keyboard shortcuts for researchers (hidden)
        document.addEventListener('keydown', function(e) {
            // Ctrl+Shift+E to export data as CSV (for testing)
            if (e.ctrlKey && e.shiftKey && e.key === 'E') {
                exportStudyDataAsCSV();
            }
            
            // Ctrl+Shift+D to display current data in console (for debugging)
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                console.log('üîç Current Study Data:', collectStudyData());
            }
        });
    </script>
</body>
</html>
